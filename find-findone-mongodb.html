<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Freedev</title>
    <link rel="stylesheet" type="text/css" href="http://antoniomalves.github.io/theme/css/screen.min.css">
    <link rel="stylesheet" type="text/css" href="http://antoniomalves.github.io/theme/css/highlight.min.css">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="publisher" href="">
    <link rel="apple-touch-startup-image" href="http://antoniomalves.github.io/theme/images/logo.png">
    <link type="text/plain" rel="socialmedia" href="http://antoniomalves.github.io/socialmedia.txt">
    <link rel="dns-prefetch" href="http://antoniomalves.github.io"/>
    <link rel="dns-prefetch" href="//www.gstatic.com"/>
    <link rel="dns-prefetch" href="//fonts.gstatic.com"/>
    <link rel="dns-prefetch" href="//fonts.googleapis.com"/>
    <link rel="dns-prefetch" href="//accounts.google.com"/>
    <link rel="dns-prefetch" href="//ssl.google-analytics.com"/>
    <link rel="dns-prefetch" href="//www.google-analytics.com"/>
    <link rel="dns-prefetch" href="//googleads.g.doubleclick.net"/>
    <link rel="dns-prefetch" href="//pagead2.googlesyndication.com"/>
    <link rel="dns-prefetch" href="//twemoji.maxcdn.com"/>
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="application-name" content="Freedev"/>
    <meta name="msapplication-starturl" content="http:http://antoniomalves.github.io"/>
    <meta name="msapplication-tooltip" content=""/>
    <meta name="msapplication-window" content="width=1024;height=768"/>
    <meta name="msapplication-task" content="name=Freedev;action-uri=http:http://antoniomalves.github.io;icon-uri=http://antoniomalves.github.io/theme/images/favicon.ico"/>
    <meta name="msapplication-TileImage" content="http://antoniomalves.github.io/theme/images/apple-touch-icon-144x144.png"/>
    <meta name="msapplication-TileColor" content="#1F1F21"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="imagetoolbar" content="no">
    <meta http-equiv="pragma" content="cache">
    <meta http-equiv="cache-control" content="cache">
    <meta http-equiv="vary" content="content-language">
    <meta http-equiv="Cache-control" content="max-age=2592000, public">
    <meta http-equiv="content-style-type" content="text/css">
    <meta name="application-name" content="Freedev">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="google-site-verification" content="">
    <meta name="alexaVerifyID" content=""/>
    <meta name="wot-verification" content=""/>
    <meta name="msvalidate.01" content="" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="medium" content="mult">
    <meta name="adblock" content="disable">
    <meta name="rating" content="General">
    <meta name="resource-type" content="document">
    <meta name="revisit-after" content="1 days">
    <meta name="revisit" content="1">
    <meta name="robots" content="index,follow">
    <meta name="no-email-collection" content="http://www.unspam.com/noemailcollection/">
    <link rel="apple-touch-icon" sizes="152x152" href="http://antoniomalves.github.io/theme/images/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="144x144" href="http://antoniomalves.github.io/theme/images/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="114x114" href="http://antoniomalves.github.io/theme/images/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="http://antoniomalves.github.io/theme/images/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="http://antoniomalves.github.io/theme/images/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="72x72" href="http://antoniomalves.github.io/theme/images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="60x60" href="http://antoniomalves.github.io/theme/images/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="57x57" href="http://antoniomalves.github.io/theme/images/apple-touch-icon-57x57.png">
    <link rel="icon" type="image/png" href="http://antoniomalves.github.io/theme/images/favicon-196x196.png" sizes="196x196">
    <link rel="icon" type="image/png" href="http://antoniomalves.github.io/theme/images/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="http://antoniomalves.github.io/theme/images/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="http://antoniomalves.github.io/theme/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="http://antoniomalves.github.io/theme/images/favicon-16x16.png" sizes="16x16">
    <link rel="shortcut icon" href="http://antoniomalves.github.io/theme/images/favicon.ico">
    <script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', '', 'auto');ga('send', 'pageview');var _qevents = _qevents || [];</script>
    <script src="//twemoji.maxcdn.com/twemoji.min.js"></script>
</head>
<body class="home-template nav-closed" itemscope itemtype="http://schema.org/WebPage">
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-ML9KT2"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-ML9KT2');</script>
<!-- End Google Tag Manager -->
    <meta itemprop="name" content="Freedev">
    <meta itemprop="url" content="http://antoniomalves.github.io">
    <meta itemprop="headline" content="Freedev || ">
    <meta itemprop="description about" content="">
    <meta itemprop="keywords" content="gnu, linux, software libre, código abierto, tecnología">
    <meta itemprop="primaryImageOfPage" content="http://antoniomalves.github.io/theme/images/logo.png">
    <meta itemprop="inLanguage" content="es">
<nav class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul role="menubar">
            <li class="nav-current" role="presentation"><a  href="http://antoniomalves.github.io/archives.html" title="Freedev | Arquivos" itemprop="name" itemprop="significantLink">Arquivos</a></li>        
    </ul>
    <a class="subscribe-button icon-feed" href='http://cloud.feedly.com/#subscription%2Ffeed%2Fhttp%3A%2F%2Ffeeds.feedburner.com%2FElBlogDeAbr4xas'  target='blank'>Subscribe</a>
</nav>
<span class="nav-cover"></span>    <div class="site-wrapper">
        <header class="main-header post-head" style="background-image: url(http://antoniomalves.github.io/theme/images/bear.jpg)" itemscope itemtype="http://schema.org/WPHeader">
            <nav class="main-nav overlay clearfix">
                <a class="menu-button" href="#">
                    <span class="burger">&#9776;</span>
                    <span class="word">Menu</span>
                </a>
            </nav>
            <div class="vertical">
                <div class="main-header-content inner">
                    <h1 class="page-title" itemprop="headline">Freedev</h1>
                    <h2 class="page-description" itemprop="description"></h2>
                </div>
            </div>
            <a class="scroll-down icon-arrow-left blink_me" href="#content" data-offset="-45">
                <span class="hidden">Scroll Down</span>
            </a>
        </header>
<main id="content" class="content" role="main">
    <article class="post" itemscope="" itemtype="http://schema.org/BlogPosting" itemprop="blogPost">
        <header class="post-header">
            <h1 class="post-title" itemprop="headline">Selecionando documentos no MongoDB</h1>
            <section class="post-meta">
                <span class="entry-author" itemscope="" itemtype="http://schema.org/Person" itemprop="author">
                    <span itemprop="name">Antonio Alves Lima</span></span>
                <time class="post-date" itemprop="datePublished" datetime="2016YYY-36M-%DD">quarta, março 30, 2016</time>
<nav role="navigation">
    <a class="newer-posts blink_me" href="http://antoniomalves.github.io">&larr; Back</a>
</nav><br/>            </section>
        </header>
        <section class="post-content">
            <h3>find e findOne.</h3>
<p>As suas queries no banco podem ser feitas com uma grande variedade de operadores, expressões e uma variadade de opções extraordinárias
o que torna o MongoDB tão poderoso e fácil de se trabalhar.
Nesse post vou mostrar alguns desses recursos dessa consulta tão poderosa.</p>
<p>Nesse momento já temos nosso banco criado e uma ou mais coleções nesse banco. A intenção aqui agora é somente
mostar como você pode utilizar dos vários recursos da consulta do MongoDB para recuperar esses documentos.</p>
<h3>A função find</h3>
<p>A função find é uma maneira de você obter dados de vários documentos contidos na sua coleção. Após sua coleção criada será uma das funções que você usará com mais frequência.</p>
<p>Vamos supor que já temos um banco customer e uma coleção chamada people.
Com o comando find simples, sem nenhum parâmetro, recuperamos todos os documentos da coleção(limitado por 20 no shell do mongo). Seria como se fizéssemos um <code>select * from</code> na tabela.</p>
<p><code>db.people.find({});</code></p>
<h4>Usando critérios para a função find</h4>
<p>Como a find nos devolve todos os documentos, sem nenhum critério, talvez não seja isso que vamos querer
ao realizar uma pesquisa, nossa clausula where do MongoDB.
Passando um argumento para o find.</p>
<p><code>db.people.find({'name':'Bill'});</code></p>
<p>Essa pesquisa retornará todos os documentos da coleção com o name igual a Bill.</p>
<h5>Mostrando somente os dados que nos interessa.</h5>
<p>Um outro argumento passado na função find é para nos apresentar somente os dados do documento que nos interessa.</p>
<p><code>db.people.find({'name': 'Bill'},{name:true, age: true, profession: true})</code></p>
<p><code>{
  "_id": ObjectId("56f562cd49bcc4a0389a8dc6"),
  "name": "Bill",
  "age": 35,
  "profession": "Doctor"
}</code></p>
<p>Os valores passados no segundo argumento representam os campos que queremos apresentar na pesquisa, mas então porque veio o campo _id?
O campo _id no segundo argumeno já vem setado como true por default, caso não queiramos mostar esse campo temos que alterar o valor desse explicitamente.</p>
<p><code>db.people.find({'name': 'Bill'},{name:true, age: true, profession: true, _id: false})</code></p>
<p><code>{
  "name": "Bill",
  "age": 35,
  "profession": "Doctor"
}</code></p>
<p>Ainda nesse segundo parâmetro passado se setarmos qualquer outra chave como false todos os dados do documento serão apresentandos,
menos a chave que setamos como false.</p>
<p><code>db.people.find({'name': 'Bill'},{name:false})</code></p>
<p><code>{
  "_id": ObjectId("56f562cd49bcc4a0389a8dc6"),
  "age": 35,
  "profession": "Doctor"
}</code></p>
<h5>Maior, Igual ou maior, Menor, Igual ou menor - $gt, $gte, $lt, $lte</h5>
<p>Com esses operadores relacionais podemos filtrar dados de chaves com valores numéricos e alfanuméricos.</p>
<p>Exemplos:</p>
<p><code>db.scores.find({score: {$gt:95}});</code></p>
<p>Essa pesquisa busca todos os documentos da coleção scores que tenha o campo score com valor maior que 95.</p>
<p><code>db.scores.find({score: {$gt:95}, type: "essay"});</code></p>
<p>Documentos com score maior que 95 e type com o valor "essay".</p>
<p><code>db.people.find({name: {$lt: "D", $gt: "B"});</code></p>
<p>Recupera todos os documentos com o valor da chave "name" começando com uma letra que seja menor que "D" e maior que "B".</p>
<h5>Type e Exists</h5>
<p>Quando precisamos verificiar se a nossa chave existe no documento ou se essa chave pertence a um determinado tipo, conforme especificação BSON.</p>
<p><code>db.people.find({profession: {$exists:true}});</code></p>
<p>Retorna os documentos onde o campo profession exista.</p>
<p><code>db.people.find({name:{$type:2}});</code></p>
<p>Retorna os documentos onde o valor do campo name seja uma String de caracteres.
caso esse valor fosse do tipo Double só precisariamos trocar o 2 pelo 1. Isso é uma implementação da especifacação BSON para tipos que tem como aliases seus correspondentes. 1(Double), 2(String), 3(Object).
https://docs.mongodb.org/manual/reference/operator/query/type/</p>
<h5>Regex</h5>
<p>Utilizando regex na pesquisa de documentos na coleção.</p>
<p><code>db.people.find({name: {$regex: "a"}});</code></p>
<p>retorna todos os documentos que contenham a letra "a" no valor da chave "name".</p>
<p><code>db.people.find({name: {$regex: "e$"}});</code></p>
<p>retorna todos os documentos que terminam com a letra "e" no valor da chave "name".</p>
<p><code>db.people.find({name: {$regex: "^A"}});</code></p>
<p>retorna todos os documentos que começam com a letra "A" no valor da chave "name".</p>
<p><code>db.users.find({name: {$regex: "q"}, email:{$exists:true}});</code></p>
<p>retorna todos os documentos onde o campo name tenha a letra "q" e a chave email exista no documento.</p>
<h5>Operador lógico</h5>
<p>Usando o operador $or
Para realizar pesquisa onde queremos que o documento retornado corresponda a qualquer um dos parâmetros que informamos na pesquisa usamos o operador $or.</p>
<p><code>db.people.find({$or:[{name: {$regex:"e$"}}, {age:{$exists:true}}]});</code></p>
<p>Essa pesquisa irá retornar todos os documentos onde a chave name tenha a letra "e" no seu valor e exista a chave "age" no documento.</p>
<p><code>db.scores.find({$or:[{score:{$lt:50}},{score:{$gt:90}}]});</code></p>
<p>Retorna os documentos com o score menor que 50 e também os documentos com o score maior que 90.</p>
<p>Usando o operador $and
Para realizar pesquisa onde queremos que o documento retornado corresponda a todos os parâmetros que informamos na pesquisa usamos o operador $and.</p>
<p><code>db.people.find({$and:[{name:{$gt:"C"}}, {name: {$regex:"a"}}]});</code></p>
<p>Retorna todos os documentos onde o valor da chave name tenha a letra "C" e também tenha a letra "a".</p>
<p>obs. para essa pesquisa também poderíamos usar a seguinte querie:</p>
<p><code>db.people.find({name: {$gt: "C", $regex: "a"}});</code></p>
<p>Atenção!!!</p>
<p><code>db.scores.find( { score : { $gt : 50 }, score : { $lt : 60 } } );</code>
Essa consulta irá recuperar todos os documentos com o score menor que 60, já que o segundo parâmetro passado na consulta substitui o primeiro.
para realizarmos essa consulta de forma correta poderíamos usar o $and ou então colocar o segundo valor($lt:60) junto com o $gt: 50 no primeiro parâmetro.</p>
<p><code>db.scores.find( { score : { $gt : 50, $lt : 60 } } );</code></p>
<h5>Trabalhando com arrays</h5>
<p>Temos os seguintes documentos na coleção accounts:</p>
<p><code>{
  "_id": ObjectId("56f5b2918c8c314a17661ea2"),
  "name": "Howard",
  "favorites": [
    "pretzels",
    "beer"
  ]
}</code></p>
<p><code>{
  "_id": ObjectId("56f5b2bb8c8c314a17661ea3"),
  "name": "George",
  "favorites": [
    "ice cream",
    "pretzels"
  ]
}</code></p>
<p>para realizarmos uma pesquisa que nos retorne o documento que contenha o valor beer dentro do array favorites.</p>
<p><code>db.accounts.find({favorites: "beer"});</code></p>
<p>Será retornado o documento que contém o valor "beer" para a chave "favorites".</p>
<p>obs. Caso exista um documento que contenha o valor "beer" para "favorites, mesmo que não esteja dentro de um array, também será retornado.</p>
<p><code>{
  "_id": ObjectId("56f5b2bb8c8c314a17661ea3"),
  "name": "Bill",
  "favorites": "beer"
}</code></p>
<p>Utilizando os operadores $in e $all
Usamos esses operadores para realizar consulta em arrays</p>
<p>o operador $all só nos retorna resultado se todos os valores passados no argumento da pesquisa existirem no array.
por exemplo:</p>
<p><code>db.accounts.find({favorites: {$all: ["pretzels", "beer"]}});</code></p>
<p>só vai retornar os documentos que contenham todos os itens passados na pesquisa(pretzels e beer).</p>
<p>O operador $in retorna o resultado dos se ao menos um dos valores passados no argumento da pesquisa existir no array.
por exemplo:</p>
<p><code>db.accounts.find({favorites:{$in : ["beer", "pretzels"]}});</code></p>
<p>vai retornar os documentos que contenham pelo menos um dos itens passado no argumento.</p>
<p>Usando o operador .(ponto) para realizar pesquisa em array.</p>
<p><code>db.users.find({"email.work" : "antonio.teste@empresa.com"});</code></p>
<p>Consulta irá retornar o documento da coleção users onde o email work for igual ao valor passado na pesquisa.</p>
<p><code>db.catalog.find({"price":{$gt:10000}, "reviews.rating":{$gte:5}});</code></p>
<p>Essa consulta retorna todos os produtos com um preço maior que 10.000,00 e com uma avaliação melhor que 5.</p>
<h5>Sort, limit e skip</h5>
<p><code>db.people.find().sort({name:1});</code></p>
<p>Usando o sortordenamos os nomes em ordem crescente. Temos duas possibilidades para sort, 1 para ASC e -1 para DESC.</p>
<p><code>dp.people.find().limit(4);</code></p>
<p>Usamos o limit para limitar o total de resultados que a consulta irá retornar.</p>
<p>Também podemos juntar o sort e limit</p>
<p><code>db.people.find().sort({name:-1}).limit(3);</code></p>
<p>Primeiro ordenamos a consulta na ordem decrescente por nomes e depois limitamos o resultado para 3.</p>
<p><code>db.people.find().sort({name:-1}).limit(3).skip(2);</code></p>
<p>Com o skip pulamos os dois primeiros resultados do nosso cursor.
Essa consulta funciona da seguinte forma:
Primeiro os nomes são ordenados na ordem decrescente, logo após é feito o escape dos dois primeiros resultados e então limitado a mostrar somente os três resultados.</p>
<h4>findOne</h4>
<p>Quando tudo o que queremos é somente um documento da nossa coleção o mongo nos oferece a função findOne que, recupera apenas um documento como resultado de pesquisa.
Todos os operadores, filtros e tudo mais que vimos na função find podem também serem utilizados na função findOne.
FindOne encontra a primeira ocorrência do documento e apresenta. Se for passado algum argumento será apresentado o primeiro documento corresponder a pesquisa feita</p>
<p><code>db.people.findOne({name: "Smith"})
{
  "_id": ObjectId("56f5619449bcc4a0389a8dc5"),
  "name": "Smith",
  "age": 30,
  "profession": "hacker"
}</code></p>
<p>Com isso terminamos a parte de pesquisa em documentos no MongoDB. É claro que isso não é tudo que é oferecido
como recurso para suas pesquisas, mas tentei ser o mais breve com o post mais abrangendo grande parte dos recursos que existe para nossa pesquisa.
Logo irei lançar um post para cada um desses recursos e fazer a apresentação desses mais resumidamente, mas com isso que foi apresentado até aqui acredito que já é um bom caminho para tornar sua pesquisa mais poderosa.
Nos vemos no próximo post!</p>
            <p>
                <a href="http://mbsy.co/bHCMB" target="_blank" style="border:none;">
                    <img src="https://ambassador-api.s3.amazonaws.com/uploads/marketing/970/2014_09_22_13_34_17.gif" alt="Code School" border="0" />
                </a>
            </p>
            <br/>
<small>Si deseas realizar una donacion via <strong>PayPal</strong> puedes hacerlo dandole un clic al cerdito...<form class="text-center" action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank"><input type="hidden" name="cmd" value="_s-xclick"><input type="hidden" name="hosted_button_id" value="RKG8G3ABP4XSW"><input type="image" src="http://antoniomalves.github.io/theme/images/1412723932_money_box.svg" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!"></form>Si deseas realizar una donacion via <strong>BTC</strong> puedes hacerlo usando<br/>esto: 1KQbQ1oWNaTeLQ671NhXS1jVd8w5yQwCmi <br/>Gracias!!</small><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7127443823639155" data-ad-slot="9038513565" data-ad-format="auto"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script>            <br/>
<nav class="pagination" role="navigation">
    <ul>
    </ul>
</nav>            <br/>
        </section>
        <footer class="post-footer">
        </footer>
    </article>
</main>
        <footer class="site-footer clearfix" role="contentinfo" itemscope itemtype="http://schema.org/WPFooter">
            <section class="copyright">
                <a itemprop="url" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" class="tooltip" data-tooltip="CC BY-NC-SA" target="_blank">
                CC Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
            </section>
            <section class="poweredby">Proudly published with <a href="https://getpelican.org">Pelican</a></section>
        </footer>
    </div>
    <script type="text/javascript" src="http://antoniomalves.github.io/theme/js/jquery-1.11.2.min.js"></script>
    <script type="text/javascript" src="http://antoniomalves.github.io/theme/js/jquery.fitvids.min.js"></script>
    <script type="text/javascript" src="http://antoniomalves.github.io/theme/js/index.min.js"></script>
    <script>twemoji.parse(document, {"size":16});</script>
</body>
</html>